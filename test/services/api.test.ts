// ####################################################################################################
// ## IMPORTACIÓNS
// ####################################################################################################
import i18next from "i18next";
const supertest = require('supertest');

const { App }  = require('../../src/services/api.service');

// ####################################################################################################
// ## UTILIDADES
// ####################################################################################################

const getAPIVersion = () => {
    let apiFullVersion = process.env.npm_package_version.split(".");
    let apiPrefix = process.env.API_PREFIX;

    let result = `${apiPrefix}${apiFullVersion[0]}`;

    return result;
};

// ####################################################################################################
// ## CONSTS
// ####################################################################################################
const api_name = process.env.APP_NAME;
const api_version = process.env.npm_package_version;
const apiVersion = getAPIVersion();

const API_BASE = `/api/${apiVersion}/`;

// Request para testing
const request = supertest(new App().app);

// ####################################################################################################
// ## TESTS GROUPS
// ####################################################################################################
describe('Probas básicas de conexión da API', () => {
    // ************************************************************************************************
    // ** ATRIBUTOS
    // ************************************************************************************************

    // ************************************************************************************************
    // ** TAREFAS PREVIAS E POSTERIORES
    // ************************************************************************************************

    // ************************************************************************************************
    // ** TESTS
    // ************************************************************************************************
    test('Info API (GET)', async() => {
        const response = await request.get(API_BASE);

        expect(response.status).toBe(200);
        expect(response.body).toBe(i18next.t('WELCOME', { app: api_name, version: api_version }));
    });
});
